# 个人笔记系统详细设计文档

## 1. 文档信息

- **文档版本**: 1.0
- **编写日期**: 2025-12-30
- **项目名称**: 个人笔记系统
- **编写人员**: [套用表]

## 2. 项目概述

### 2.1 项目目标
个人笔记系统是一个基于VSCode的笔记管理工具，旨在帮助用户高效记录日常工作、自动生成日报以及评估工作状态。系统通过模板化笔记创建、AI驱动的笔记评价等功能，提升个人知识管理效率。

### 2.2 核心功能
- 自动创建日期目录
- 模板化笔记创建
- 快捷键操作
- AI驱动的笔记汇总与评价
- 主线任务检查机制

## 3. 系统架构

### 3.1 C4组件图

```mermaid
C4Context
title 个人笔记系统上下文图

Person(user, "用户", "使用笔记系统的个人用户")
System_Boundary(noteSystem, "个人笔记系统") {
    System(aiService, "AI服务", "如OpenAI API")
    System(editor, "VSCode", "编辑器环境")
}

Rel(user, noteSystem, "使用", "通过快捷键和命令面板")
Rel(noteSystem, aiService, "调用", "用于AI分析和评价")
Rel(noteSystem, editor, "集成于", "VSCode扩展环境")
```

```mermaid
C4Container
title 个人笔记系统容器图

Person(user, "用户", "使用笔记系统的个人用户")

System_Boundary(noteSystem, "个人笔记系统") {
    Container(shortcuts, "快捷键", "VSCode Keybindings", "Ctrl+Alt+1/2/3 创建不同类型笔记")
    Container(commandPalette, "命令面板", "VSCode Tasks", "通过Tasks: Run Task执行任务")
    Container(createNoteScript, "create_note.py", "Python脚本", "根据模板创建笔记文件")
    Container(summarizeScript, "summarize_notes.py", "Python脚本", "AI驱动的笔记分析和评价")
    Container(checkScript, "main_check.py", "Python脚本", "主线任务检查逻辑")
    Container(noteStorage, "daynote/*", "文件系统", "按日期组织的笔记目录")
    Container(reportStorage, "日报/*", "文件系统", "自动生成的日报和评价报告")
    Container(noteTemplates, "model/*.md", "Markdown文件", "笔记模板文件")
}

System_Ext(aiService, "AI服务", "如OpenAI API")
System_Ext(editor, "VSCode", "编辑器环境")

Rel(user, shortcuts, "使用", "通过快捷键")
Rel(user, commandPalette, "使用", "通过命令面板")
Rel(shortcuts, createNoteScript, "触发", "创建笔记")
Rel(commandPalette, createNoteScript, "执行", "创建笔记")
Rel(commandPalette, summarizeScript, "执行", "AI分析")
Rel(commandPalette, checkScript, "执行", "主线检查")
Rel(createNoteScript, noteTemplates, "读取", "获取模板")
Rel(createNoteScript, noteStorage, "写入", "保存笔记")
Rel(summarizeScript, noteStorage, "读取", "分析笔记")
Rel(summarizeScript, reportStorage, "写入", "生成报告")
Rel(summarizeScript, aiService, "调用", "AI API请求")
Rel(checkScript, noteStorage, "读取", "检查内容")
Rel(editor, shortcuts, "提供环境", "VSCode编辑器")
```



```mermaid
C4Component
title 个人笔记系统组件图

Person(user, "用户", "使用笔记系统的个人用户")

System_Boundary(noteSystem, "个人笔记系统") {
    Container_Boundary(ui, "界面层") {
        Component(shortcuts, "快捷键", "VSCode Keybindings", "Ctrl+Alt+1/2/3 创建不同类型笔记")
        Component(commandPalette, "命令面板", "VSCode Tasks", "通过Tasks: Run Task执行任务")
    }
    
    Container_Boundary(config, "配置层") {
        Component(tasksConfig, "tasks.json", "JSON配置", "定义VSCode可执行任务")
        Component(keybindingsConfig, "keybindings.json", "JSON配置", "定义快捷键映射")
    }
    
    Container_Boundary(app, "应用层") {
        Component(createNoteScript, "create_note.py", "Python脚本", "根据模板创建笔记文件")
        Component(summarizeScript, "summarize_notes.py", "Python脚本", "AI驱动的笔记分析和评价")
        Component(checkScript, "main_check.py", "Python脚本", "主线任务检查逻辑")
        Component(projectFinder, "find_project_root", "Python函数", "动态查找项目根目录")
        Component(noteContentExtractor, "extract_note_content", "Python函数", "从笔记中提取内容")
    }
    
    Container_Boundary(data, "数据层") {
        Component(noteStorage, "daynote/*", "文件系统", "按日期组织的笔记目录")
        Component(reportStorage, "日报/*", "文件系统", "自动生成的日报和评价报告")
        Component(noteTemplates, "model/*.md", "Markdown文件", "笔记模板文件")
    }
}

System_Ext(aiService, "AI服务", "如OpenAI API")
System_Ext(editor, "VSCode", "编辑器环境")

Rel(user, shortcuts, "使用", "通过快捷键")
Rel(user, commandPalette, "使用", "通过命令面板")
Rel(shortcuts, keybindingsConfig, "读取配置", "快捷键映射")
Rel(commandPalette, tasksConfig, "读取配置", "任务定义")
Rel(tasksConfig, createNoteScript, "执行", "运行笔记创建脚本")
Rel(tasksConfig, summarizeScript, "执行", "运行AI分析脚本")
Rel(tasksConfig, checkScript, "执行", "运行主线检查脚本")
Rel(createNoteScript, projectFinder, "使用", "查找项目根目录")
Rel(createNoteScript, noteTemplates, "读取", "获取模板内容")
Rel(createNoteScript, noteStorage, "写入", "创建笔记文件")
Rel(summarizeScript, noteContentExtractor, "使用", "提取笔记内容")
Rel(summarizeScript, noteStorage, "读取", "分析笔记内容")
Rel(summarizeScript, reportStorage, "写入", "生成评价报告")
Rel(summarizeScript, aiService, "调用", "AI API请求")
Rel(checkScript, noteStorage, "读取", "检查笔记内容")
Rel(editor, shortcuts, "提供环境", "VSCode编辑器")
```

## 4. 核心模块详细设计

### 4.1 笔记创建模块 (create_note.py)

#### 4.1.1 模块功能
- 根据模板类型创建笔记文件
- 自动创建日期目录
- 替换模板中的日期占位符



#### 4.1.3 主要函数设计

**find_project_root()**
- **功能**: 动态查找项目根目录
- **输入**: 无
- **输出**: 项目根目录路径
- **逻辑**: 从当前脚本位置向上查找包含README.md的目录

**create_note(template_type)**
- **功能**: 根据模板类型创建笔记
- **输入**: template_type (模板类型: inspiration, report, 或自定义)
- **输出**: 创建的文件路径
- **逻辑**: 
  1. 获取当前日期和时间
  2. 根据模板类型确定路径和文件名
  3. 创建目标目录
  4. 复制模板文件
  5. 替换日期占位符

#### 4.1.4 流程图

```mermaid
flowchart TD
    A[开始 create_note] --> B[获取当前日期时间]
    B --> C[查找项目根目录]
    C --> D{判断模板类型}
    D -->|inspiration| E[设置灵感笔记路径]
    D -->|report| F[设置日报路径]
    D -->|custom| G[设置自定义路径]
    E --> H[创建目标目录]
    F --> H
    G --> H
    H --> I[复制模板文件]
    I --> J[替换日期占位符]
    J --> K[返回文件路径]
    K --> L[结束]
```

### 4.2 AI笔记评价模块 (summarize_notes.py)

#### 4.2.1 模块功能
- 收集当天的灵感笔记
- 使用AI对笔记进行总结
- 基于综合评价标准对笔记进行评分
- 生成评价报告

#### 4.2.2 类图

```mermaid
classDiagram
    class SummarizeNotes {
        -list get_todays_notes()
        -dict extract_note_content(str note_path)
        -str call_openai_api(str prompt)
        -str ai_summarize_notes(list notes_data)
        -dict evaluate_note_with_ai(dict note_data)
        -dict evaluate_note(dict note_data)
        -str generate_report(list notes_paths, list notes_data, str summary, list evaluations)
        -str save_report(str report_content)
        +main()
    }
    
    class DateTime {
        +str strftime(str format)
    }
    
    class OS {
        +bool makedirs(str path, bool exist_ok)
        +bool exists(str path)
        +str join(str path, str* paths)
    }
    
    class File {
        +file open(str path, str mode)
        +str read()
        +write(str content)
    }
    
    class OpenAI {
        +chat.completions.create()
    }
    
    SummarizeNotes --> DateTime : 使用
    SummarizeNotes --> OS : 使用
    SummarizeNotes --> File : 使用
    SummarizeNotes --> OpenAI : 使用
```

#### 4.2.4 逻辑流程图

```mermaid
flowchart TD
    A[开始 main函数] --> B[获取今天的灵感笔记]
    B --> C{是否有笔记?}
    C -->|否| D[打印未找到笔记信息]
    C -->|是| E[提取笔记内容]
    E --> F[AI总结笔记内容]
    F --> G[评价所有笔记]
    G --> H[生成完整评估报告]
    H --> I[保存报告到文件]
    I --> J[显示报告摘要]
    J --> K[结束]
    D --> K
```

#### 4.2.5 函数调用关系图

```mermaid
graph TD
    A[main] --> B[get_todays_notes]
    A --> C[extract_note_content]
    A --> D[ai_summarize_notes]
    A --> E[evaluate_note_with_ai]
    A --> F[generate_report]
    A --> G[save_report]
    
    B --> H[find_project_root]
    C --> H
    D --> I[call_openai_api]
    E --> I
    E --> J[evaluate_note]
    F --> K[datetime.now]
    
    I --> L[OpenAI API调用]
    
    style A fill:#e1f5fe
    style I fill:#fff3e0
    style L fill:#ffebee
```

#### 4.2.3 主要函数设计

**get_todays_notes()**
- **功能**: 获取今天的全部灵感笔记
- **输入**: 无
- **输出**: 今天所有灵感笔记文件路径的列表
- **逻辑**: 
  1. 获取今天的日期
  2. 检查对应日期目录是否存在
  3. 查找所有以"灵感-"开头的笔记文件

**extract_note_content(note_path)**
- **功能**: 提取笔记的核心内容
- **输入**: note_path (笔记文件路径)
- **输出**: 包含各部分内容的字典
- **逻辑**: 
  1. 读取笔记文件内容
  2. 使用正则表达式提取各个部分的内容
  3. 返回包含"创意点"、"遇到的问题"、"解决方案"、"学到的知识"的字典

**call_openai_api(prompt)**
- **功能**: 调用OpenAI API
- **输入**: prompt (发送给模型的提示文本)
- **输出**: 模型返回的结果
- **逻辑**: 
  1. 从环境变量获取API密钥
  2. 创建OpenAI客户端
  3. 调用模型并返回结果

**evaluate_note_with_ai(note_data)**
- **功能**: 使用AI对笔记进行评价
- **输入**: note_data (单条笔记的数据)
- **输出**: 包含各项评分和总分的字典
- **逻辑**: 
  1. 构造AI提示词
  2. 调用AI获取评分
  3. 解析AI返回的评分



### 4.3 主线任务检查模块 (main_check.py)

#### 4.3.1 模块功能
- 检查当前任务是否符合项目主线目标
- 确保开发工作围绕当前版本目标进行

#### 4.3.2 类图

```mermaid
classDiagram
    class MainCheck {
        -str read_task_file()
        -str get_current_version(str tasks_content)
        -bool check_task_alignment(str task_description, str current_version)
        +main()
    }
    
    class File {
        +file open(str path, str mode)
        +str read()
    }
    
    class System {
        +exit(int code)
    }
    
    MainCheck --> File : 使用
    MainCheck --> System : 使用
```

#### 4.3.3 主要函数设计

**read_task_file()**
- **功能**: 读取任务文件内容
- **输入**: 无
- **输出**: 任务文件内容
- **逻辑**: 读取task.md文件内容

**get_current_version(tasks_content)**
- **功能**: 从任务内容中提取当前进行中的版本
- **输入**: tasks_content (任务文件内容)
- **输出**: 当前版本号
- **逻辑**: 解析任务内容，提取进行中的版本

**check_task_alignment(task_description, current_version)**
- **功能**: 检查任务是否与当前版本对齐
- **输入**: task_description (任务描述), current_version (当前版本)
- **输出**: 布尔值，表示是否对齐
- **逻辑**: 检查任务描述中是否包含版本信息

## 5. 数据结构设计

### 5.1 笔记内容结构
```python
content_sections = {
    "创意点": "",
    "遇到的问题": "",
    "解决方案": "",
    "学到的知识": ""
}
```

### 5.2 评价结果结构
```python
scores = {
    "完整性": 0,
    "深度": 0,
    "实用性": 0,
    "创新性": 0,
    "反思性": 0,
    "AI评语": "",
    "总分": 0
}
```

## 6. 接口设计

### 6.1 VSCode任务接口
- **创建灵感笔记**: `create-inspiration-note`
- **创建日报**: `create-report-note`
- **创建自定义笔记**: `create-custom-note`

### 6.2 命令行接口
- **创建笔记**: `python scripts/create_note.py --template [type]`
- **AI评价**: `python scripts/summarize_notes.py`
- **主线检查**: `python main_check.py`

## 7. 部署和配置

### 7.1 依赖库
- `openai`: 用于调用OpenAI API
- `markdownify`: 用于解析markdown内容

### 7.2 环境变量
- `OPENAI_API_KEY`: OpenAI API密钥
- `OPENAI_BASE_URL`: OpenAI API基础URL
- `OPENAI_MODEL`: 使用的模型名称

### 7.3 配置文件
- `.vscode/tasks.json`: VSCode任务配置
- `.vscode/keybindings.json`: 快捷键配置
- `daynote/model/*.md`: 笔记模板

## 8. 错误处理

### 8.1 异常处理策略
- 文件不存在时的处理
- API调用失败时的处理
- 模板解析错误的处理

### 8.2 日志记录
- 关键操作的日志输出
- 错误信息的详细记录

## 9. 性能考虑

### 9.1 优化策略
- 文件操作的批量处理
- AI API调用的并发控制
- 模板解析的缓存机制

## 10. 安全考虑

### 10.1 API密钥安全
- 环境变量存储API密钥
- 不在代码中硬编码密钥

### 10.2 文件权限
- 合理设置文件读写权限
- 防止非法文件访问